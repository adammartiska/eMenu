{"ast":null,"code":"import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { getLogger } from './logger';\nimport { notifyManager } from './notifyManager';\nimport { Retryer } from './retryer';\nimport { noop } from './utils'; // TYPES\n// CLASS\n\nexport var Mutation = /*#__PURE__*/function () {\n  function Mutation(config) {\n    this.options = _extends({}, config.defaultOptions, config.options);\n    this.mutationId = config.mutationId;\n    this.mutationCache = config.mutationCache;\n    this.observers = [];\n    this.state = config.state || getDefaultState();\n    this.meta = config.meta;\n  }\n\n  var _proto = Mutation.prototype;\n\n  _proto.setState = function setState(state) {\n    this.dispatch({\n      type: 'setState',\n      state: state\n    });\n  };\n\n  _proto.addObserver = function addObserver(observer) {\n    if (this.observers.indexOf(observer) === -1) {\n      this.observers.push(observer);\n    }\n  };\n\n  _proto.removeObserver = function removeObserver(observer) {\n    this.observers = this.observers.filter(function (x) {\n      return x !== observer;\n    });\n  };\n\n  _proto.cancel = function cancel() {\n    if (this.retryer) {\n      this.retryer.cancel();\n      return this.retryer.promise.then(noop).catch(noop);\n    }\n\n    return Promise.resolve();\n  };\n\n  _proto.continue = function _continue() {\n    if (this.retryer) {\n      this.retryer.continue();\n      return this.retryer.promise;\n    }\n\n    return this.execute();\n  };\n\n  _proto.execute = function execute() {\n    var _this = this;\n\n    var data;\n    var restored = this.state.status === 'loading';\n    var promise = Promise.resolve();\n\n    if (!restored) {\n      this.dispatch({\n        type: 'loading',\n        variables: this.options.variables\n      });\n      promise = promise.then(function () {\n        // Notify cache callback\n        _this.mutationCache.config.onMutate == null ? void 0 : _this.mutationCache.config.onMutate(_this.state.variables, _this);\n      }).then(function () {\n        return _this.options.onMutate == null ? void 0 : _this.options.onMutate(_this.state.variables);\n      }).then(function (context) {\n        if (context !== _this.state.context) {\n          _this.dispatch({\n            type: 'loading',\n            context: context,\n            variables: _this.state.variables\n          });\n        }\n      });\n    }\n\n    return promise.then(function () {\n      return _this.executeMutation();\n    }).then(function (result) {\n      data = result; // Notify cache callback\n\n      _this.mutationCache.config.onSuccess == null ? void 0 : _this.mutationCache.config.onSuccess(data, _this.state.variables, _this.state.context, _this);\n    }).then(function () {\n      return _this.options.onSuccess == null ? void 0 : _this.options.onSuccess(data, _this.state.variables, _this.state.context);\n    }).then(function () {\n      return _this.options.onSettled == null ? void 0 : _this.options.onSettled(data, null, _this.state.variables, _this.state.context);\n    }).then(function () {\n      _this.dispatch({\n        type: 'success',\n        data: data\n      });\n\n      return data;\n    }).catch(function (error) {\n      // Notify cache callback\n      _this.mutationCache.config.onError == null ? void 0 : _this.mutationCache.config.onError(error, _this.state.variables, _this.state.context, _this); // Log error\n\n      getLogger().error(error);\n      return Promise.resolve().then(function () {\n        return _this.options.onError == null ? void 0 : _this.options.onError(error, _this.state.variables, _this.state.context);\n      }).then(function () {\n        return _this.options.onSettled == null ? void 0 : _this.options.onSettled(undefined, error, _this.state.variables, _this.state.context);\n      }).then(function () {\n        _this.dispatch({\n          type: 'error',\n          error: error\n        });\n\n        throw error;\n      });\n    });\n  };\n\n  _proto.executeMutation = function executeMutation() {\n    var _this2 = this,\n        _this$options$retry;\n\n    this.retryer = new Retryer({\n      fn: function fn() {\n        if (!_this2.options.mutationFn) {\n          return Promise.reject('No mutationFn found');\n        }\n\n        return _this2.options.mutationFn(_this2.state.variables);\n      },\n      onFail: function onFail() {\n        _this2.dispatch({\n          type: 'failed'\n        });\n      },\n      onPause: function onPause() {\n        _this2.dispatch({\n          type: 'pause'\n        });\n      },\n      onContinue: function onContinue() {\n        _this2.dispatch({\n          type: 'continue'\n        });\n      },\n      retry: (_this$options$retry = this.options.retry) != null ? _this$options$retry : 0,\n      retryDelay: this.options.retryDelay\n    });\n    return this.retryer.promise;\n  };\n\n  _proto.dispatch = function dispatch(action) {\n    var _this3 = this;\n\n    this.state = reducer(this.state, action);\n    notifyManager.batch(function () {\n      _this3.observers.forEach(function (observer) {\n        observer.onMutationUpdate(action);\n      });\n\n      _this3.mutationCache.notify(_this3);\n    });\n  };\n\n  return Mutation;\n}();\nexport function getDefaultState() {\n  return {\n    context: undefined,\n    data: undefined,\n    error: null,\n    failureCount: 0,\n    isPaused: false,\n    status: 'idle',\n    variables: undefined\n  };\n}\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'failed':\n      return _extends({}, state, {\n        failureCount: state.failureCount + 1\n      });\n\n    case 'pause':\n      return _extends({}, state, {\n        isPaused: true\n      });\n\n    case 'continue':\n      return _extends({}, state, {\n        isPaused: false\n      });\n\n    case 'loading':\n      return _extends({}, state, {\n        context: action.context,\n        data: undefined,\n        error: null,\n        isPaused: false,\n        status: 'loading',\n        variables: action.variables\n      });\n\n    case 'success':\n      return _extends({}, state, {\n        data: action.data,\n        error: null,\n        status: 'success',\n        isPaused: false\n      });\n\n    case 'error':\n      return _extends({}, state, {\n        data: undefined,\n        error: action.error,\n        failureCount: state.failureCount + 1,\n        isPaused: false,\n        status: 'error'\n      });\n\n    case 'setState':\n      return _extends({}, state, action.state);\n\n    default:\n      return state;\n  }\n}","map":{"version":3,"sources":["/Users/adammartiska/Projects/eMenu/GUI/eMenu-customer/node_modules/react-query/es/core/mutation.js"],"names":["_extends","getLogger","notifyManager","Retryer","noop","Mutation","config","options","defaultOptions","mutationId","mutationCache","observers","state","getDefaultState","meta","_proto","prototype","setState","dispatch","type","addObserver","observer","indexOf","push","removeObserver","filter","x","cancel","retryer","promise","then","catch","Promise","resolve","continue","_continue","execute","_this","data","restored","status","variables","onMutate","context","executeMutation","result","onSuccess","onSettled","error","onError","undefined","_this2","_this$options$retry","fn","mutationFn","reject","onFail","onPause","onContinue","retry","retryDelay","action","_this3","reducer","batch","forEach","onMutationUpdate","notify","failureCount","isPaused"],"mappings":"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","sourcesContent":["import _extends from \"@babel/runtime/helpers/esm/extends\";\nimport { getLogger } from './logger';\nimport { notifyManager } from './notifyManager';\nimport { Retryer } from './retryer';\nimport { noop } from './utils'; // TYPES\n\n// CLASS\nexport var Mutation = /*#__PURE__*/function () {\n  function Mutation(config) {\n    this.options = _extends({}, config.defaultOptions, config.options);\n    this.mutationId = config.mutationId;\n    this.mutationCache = config.mutationCache;\n    this.observers = [];\n    this.state = config.state || getDefaultState();\n    this.meta = config.meta;\n  }\n\n  var _proto = Mutation.prototype;\n\n  _proto.setState = function setState(state) {\n    this.dispatch({\n      type: 'setState',\n      state: state\n    });\n  };\n\n  _proto.addObserver = function addObserver(observer) {\n    if (this.observers.indexOf(observer) === -1) {\n      this.observers.push(observer);\n    }\n  };\n\n  _proto.removeObserver = function removeObserver(observer) {\n    this.observers = this.observers.filter(function (x) {\n      return x !== observer;\n    });\n  };\n\n  _proto.cancel = function cancel() {\n    if (this.retryer) {\n      this.retryer.cancel();\n      return this.retryer.promise.then(noop).catch(noop);\n    }\n\n    return Promise.resolve();\n  };\n\n  _proto.continue = function _continue() {\n    if (this.retryer) {\n      this.retryer.continue();\n      return this.retryer.promise;\n    }\n\n    return this.execute();\n  };\n\n  _proto.execute = function execute() {\n    var _this = this;\n\n    var data;\n    var restored = this.state.status === 'loading';\n    var promise = Promise.resolve();\n\n    if (!restored) {\n      this.dispatch({\n        type: 'loading',\n        variables: this.options.variables\n      });\n      promise = promise.then(function () {\n        // Notify cache callback\n        _this.mutationCache.config.onMutate == null ? void 0 : _this.mutationCache.config.onMutate(_this.state.variables, _this);\n      }).then(function () {\n        return _this.options.onMutate == null ? void 0 : _this.options.onMutate(_this.state.variables);\n      }).then(function (context) {\n        if (context !== _this.state.context) {\n          _this.dispatch({\n            type: 'loading',\n            context: context,\n            variables: _this.state.variables\n          });\n        }\n      });\n    }\n\n    return promise.then(function () {\n      return _this.executeMutation();\n    }).then(function (result) {\n      data = result; // Notify cache callback\n\n      _this.mutationCache.config.onSuccess == null ? void 0 : _this.mutationCache.config.onSuccess(data, _this.state.variables, _this.state.context, _this);\n    }).then(function () {\n      return _this.options.onSuccess == null ? void 0 : _this.options.onSuccess(data, _this.state.variables, _this.state.context);\n    }).then(function () {\n      return _this.options.onSettled == null ? void 0 : _this.options.onSettled(data, null, _this.state.variables, _this.state.context);\n    }).then(function () {\n      _this.dispatch({\n        type: 'success',\n        data: data\n      });\n\n      return data;\n    }).catch(function (error) {\n      // Notify cache callback\n      _this.mutationCache.config.onError == null ? void 0 : _this.mutationCache.config.onError(error, _this.state.variables, _this.state.context, _this); // Log error\n\n      getLogger().error(error);\n      return Promise.resolve().then(function () {\n        return _this.options.onError == null ? void 0 : _this.options.onError(error, _this.state.variables, _this.state.context);\n      }).then(function () {\n        return _this.options.onSettled == null ? void 0 : _this.options.onSettled(undefined, error, _this.state.variables, _this.state.context);\n      }).then(function () {\n        _this.dispatch({\n          type: 'error',\n          error: error\n        });\n\n        throw error;\n      });\n    });\n  };\n\n  _proto.executeMutation = function executeMutation() {\n    var _this2 = this,\n        _this$options$retry;\n\n    this.retryer = new Retryer({\n      fn: function fn() {\n        if (!_this2.options.mutationFn) {\n          return Promise.reject('No mutationFn found');\n        }\n\n        return _this2.options.mutationFn(_this2.state.variables);\n      },\n      onFail: function onFail() {\n        _this2.dispatch({\n          type: 'failed'\n        });\n      },\n      onPause: function onPause() {\n        _this2.dispatch({\n          type: 'pause'\n        });\n      },\n      onContinue: function onContinue() {\n        _this2.dispatch({\n          type: 'continue'\n        });\n      },\n      retry: (_this$options$retry = this.options.retry) != null ? _this$options$retry : 0,\n      retryDelay: this.options.retryDelay\n    });\n    return this.retryer.promise;\n  };\n\n  _proto.dispatch = function dispatch(action) {\n    var _this3 = this;\n\n    this.state = reducer(this.state, action);\n    notifyManager.batch(function () {\n      _this3.observers.forEach(function (observer) {\n        observer.onMutationUpdate(action);\n      });\n\n      _this3.mutationCache.notify(_this3);\n    });\n  };\n\n  return Mutation;\n}();\nexport function getDefaultState() {\n  return {\n    context: undefined,\n    data: undefined,\n    error: null,\n    failureCount: 0,\n    isPaused: false,\n    status: 'idle',\n    variables: undefined\n  };\n}\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'failed':\n      return _extends({}, state, {\n        failureCount: state.failureCount + 1\n      });\n\n    case 'pause':\n      return _extends({}, state, {\n        isPaused: true\n      });\n\n    case 'continue':\n      return _extends({}, state, {\n        isPaused: false\n      });\n\n    case 'loading':\n      return _extends({}, state, {\n        context: action.context,\n        data: undefined,\n        error: null,\n        isPaused: false,\n        status: 'loading',\n        variables: action.variables\n      });\n\n    case 'success':\n      return _extends({}, state, {\n        data: action.data,\n        error: null,\n        status: 'success',\n        isPaused: false\n      });\n\n    case 'error':\n      return _extends({}, state, {\n        data: undefined,\n        error: action.error,\n        failureCount: state.failureCount + 1,\n        isPaused: false,\n        status: 'error'\n      });\n\n    case 'setState':\n      return _extends({}, state, action.state);\n\n    default:\n      return state;\n  }\n}"]},"metadata":{},"sourceType":"module"}